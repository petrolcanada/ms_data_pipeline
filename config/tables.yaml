# Snowflake Table Sync Configuration
tables:
  - name: "FUND_SHARE_CLASS_BASIC_INFO_CA_OPENEND"
    snowflake:
      database: "CIGAM_PRD_RL"
      schema: "MORNINGSTAR_MAIN"
      table: "FUND_SHARE_CLASS_BASIC_INFO_CA_OPENEND"
      # Optional: Filter data during export
      # Single filter (string):
      # filter: "WHERE SECID IN (SELECT SECID FROM CIGAM_PRD_RL.MORNINGSTAR_MAIN.VW_ACTIVE_FUNDS)"
      
      # Multiple filters (list) - recommended for complex conditions:
      filter:
        - "where _id in (select mstarid from CIGAM_SBX_PL.DNA_ANALYTICS_INSIGHTS_INVESTMENT_PRODUCT.V_MSTAR_PEERS_FCLASS_ETF_ID_CA_OPENEND)"
        # - "AND _TIMESTAMPTO LIKE '%9999%'"
    postgres:
      schema: "ms"
      table: "FUND_SHARE_CLASS_BASIC_INFO_CA_OPENEND"
    # Optional: Customize for this specific table
    # export:
    #   chunk_size: 50000         # Smaller chunks for this table
    # import:
    #   batch_size: 5000          # Smaller batches for this table

  - name: "FUND_ATTRIBUTES_CA_OPENEND"
    snowflake:
      database: "CIGAM_PRD_RL"
      schema: "MORNINGSTAR_MAIN"
      table: "FUND_ATTRIBUTES_CA_OPENEND"
      # Optional: Filter data during export
      # Single filter (string):
      # filter: "WHERE SECID IN (SELECT SECID FROM CIGAM_PRD_RL.MORNINGSTAR_MAIN.VW_ACTIVE_FUNDS)"
      
      # Multiple filters (list) - recommended for complex conditions:
      filter:
        - "where _id in (select mstarid from CIGAM_SBX_PL.DNA_ANALYTICS_INSIGHTS_INVESTMENT_PRODUCT.V_MSTAR_PEERS_FCLASS_ETF_ID_CA_OPENEND)"
        - "AND _TIMESTAMPTO LIKE '%9999%'"
    postgres:
      schema: "ms"
      table: "FUND_ATTRIBUTES_CA_OPENEND"
    # Optional: Customize for this specific table
    # export:
    #   chunk_size: 50000         # Smaller chunks for this table
    # import:
    #   batch_size: 5000          # Smaller batches for this table

  - name: "MONTH_END_TRAILING_TOTAL_RETURNS_CA_OPENEND"
    snowflake:
      database: "CIGAM_PRD_RL"
      schema: "MORNINGSTAR_MAIN"
      table: "MONTH_END_TRAILING_TOTAL_RETURNS_CA_OPENEND"
      # Filter with QUALIFY clause for deduplication
      # Gets latest record per _ID and MONTHENDDATE combination
      filter:
        - "WHERE _ID IN (SELECT mstarid FROM CIGAM_SBX_PL.DNA_ANALYTICS_INSIGHTS_INVESTMENT_PRODUCT.V_MSTAR_PEERS_FCLASS_ETF_ID_CA_OPENEND)"
        - "QUALIFY ROW_NUMBER() OVER (PARTITION BY _ID, MONTHENDDATE ORDER BY _TIMESTAMPTO DESC) = 1"
    postgres:
      schema: "ms"
      table: "MONTH_END_TRAILING_TOTAL_RETURNS_CA_OPENEND"
    # Optional: Customize for this specific table
    # export:
    #   chunk_size: 50000         # Smaller chunks for this table
    # import:
    #   batch_size: 5000          # Smaller batches for this table





-- Generated for each table listed
SELECT *, _ID, MONTHENDDATE
FROM CIGAM_PRD_RL.MORNINGSTAR_MAIN.MONTH_END_TRAILING_TOTAL_RETURNS_CA_OPENEND LIMIT 100;
, QUALIFY

SELECT *, _ID, ESTFUNDLEVELNETFLOWDATEMOEND,   
FROM CIGAM_PRD_RL.MORNINGSTAR_MAIN.FUND_FLOW_DETAILS_CA_OPENEND LIMIT 100; -- FLow
, QUALIFY BY _TIMESTMPTO DESC=1 


SELECT *, _ID, RATINGDATE  FROM CIGAM_PRD_RL.MORNINGSTAR_MAIN.MORNINGSTAR_RATING_EXTENDED_PERFORMANCE_CA_OPENEND LIMIT 100; --Rating
, QUALIFY BY ROW_NUMBER() OVER (PARTITION BY _ID, RATINGDATE ORDER BY _TIMESTMPTO DESC=1  

SELECT *, _ID, MONTHENDDATE FROM CIGAM_PRD_RL.MORNINGSTAR_MAIN.MONTH_END_TRAILING_TOTAL_RETURN_PERCENTILE_AND_ABSOLUTE_RANKS_CA_OPENEND LIMIT 100; -- Monthly ranks
SELECT *, _ID, ENDDATE FROM CIGAM_PRD_RL.MORNINGSTAR_MAIN.RELATIVE_RISK_MEASURE_PROSPECTUS_CA_OPENEND LIMIT 100; --Relative risk
, QUALIFY BY _TIMESTMPTO DESC=1


SELECT *, _ID, NETASSETSDATE FROM CIGAM_PRD_RL.MORNINGSTAR_MAIN.FUND_LEVEL_NET_ASSETS_CA_OPENEND LIMIT 100; 
QUALIFY

SELECT *, _ID, ENDDATE FROM CIGAM_PRD_RL.MORNINGSTAR_MAIN.RISK_MEASURE_CA_OPENEND LIMIT 100;
QUALIFY

SELECT *, _ID FROM CIGAM_PRD_RL.MORNINGSTAR_MAIN.FUND_MANAGER_CA_OPENEND  LIMIT 100;
QUALIFY 

SELECT *, _ID FROM CIGAM_PRD_RL.MORNINGSTAR_MAIN.FUND_ATTRIBUTES_CA_OPENEND LIMIT 100;
QUALIFY 

SELECT *, _ID FROM CIGAM_PRD_RL.MORNINGSTAR_MAIN.PROSPECTUS_FEES_CA_OPENEND LIMIT 100;
QUALIFY


SELECT *, _ID, ANNUALREPORTDATE FROM CIGAM_PRD_RL.MORNINGSTAR_MAIN.ANNUAL_REPORT_FEES_CA_OPENEND LIMIT 100;
QUALIFY

SELECT *, _ID, RATINGDATE FROM CIGAM_PRD_RL.MORNINGSTAR_MAIN.MORNINGSTAR_RATING_CA_OPENEND LIMIT 100;
Qualify

SELECT *, _ID, FEELEVELDATE FROM CIGAM_PRD_RL.MORNINGSTAR_MAIN.FEE_LEVELS_CA_OPENEND  LIMIT 100;
QUALIFY

